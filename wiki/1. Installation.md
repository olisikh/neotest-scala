# Installation

This guide covers installing and configuring `neotest-scala` for Neovim.

## Requirements

| Requirement | Version | Purpose |
|-------------|---------|---------|
| **Neovim** | 0.8+ | Core editor with LSP and Treesitter support |
| **neotest** | Latest | Test runner framework |
| **nvim-metals** | Latest | Scala LSP server for project metadata |
| **sbt** | 1.x | Build tool for running tests |
| **Treesitter Scala** | Latest | Scala parser for test discovery |

### Verifying Requirements

```vim
" Check Neovim version
:version
" Should show v0.8.0 or higher

" Check if Treesitter Scala parser is installed
:TSInstallInfo
" Should show scala installed

" Check if Metals is running
:LspInfo
" Should show metals attached to Scala buffers
```

## Installation

### lazy.nvim (Recommended)

```lua
{
  'nvim-neotest/neotest',
  dependencies = {
    'nvim-neotest/neotest-plenary',
    'olisikh/neotest-scala',
  },
}
```

With custom configuration:

```lua
{
  'nvim-neotest/neotest',
  dependencies = {
    'nvim-neotest/neotest-plenary',
    'olisikh/neotest-scala',
  },
  config = function()
    require("neotest").setup({
      adapters = {
        require("neotest-scala")({
          args = { "--no-colors" },
        })
      }
    })
  end,
}
```

### packer.nvim

```lua
use {
  'nvim-neotest/neotest',
  requires = {
    'nvim-neotest/neotest-plenary',
    'olisikh/neotest-scala',
  },
  config = function()
    require("neotest").setup({
      adapters = {
        require("neotest-scala")
      }
    })
  end,
}
```

### vim-plug

```vim
" Required dependencies
Plug 'nvim-neotest/neotest'
Plug 'nvim-neotest/neotest-plenary'
Plug 'olisikh/neotest-scala'
```

Then add to your `init.vim` or a separate Lua config file:

```lua
require("neotest").setup({
  adapters = {
    require("neotest-scala")
  }
})
```

## Post-Install Setup

### 1. Install Treesitter Scala Parser

```vim
:TSInstall scala
```

### 2. Configure Metals

`neotest-scala` requires Metals to be running and attached to your Scala buffers. If you're using `nvim-metals`, ensure it's properly configured:

```lua
local metals_config = require('metals').bare_config()

metals_config.settings = {
  showImplicitArguments = true,
  showImplicitConversionsAndClasses = true,
  showInferredType = true,
}

-- Autocommand to start Metals
vim.api.nvim_create_autocmd("FileType", {
  pattern = { "scala", "sbt" },
  callback = function()
    require("metals").initialize_or_attach(metals_config)
  end,
  group = vim.api.nvim_create_augroup("nvim-metals", { clear = true }),
})
```

### 3. Verify Installation

1. Open a Scala test file in a project with Metals configured
2. Wait for Metals to initialize (check `:LspInfo`)
3. Run a test with Neotest:

```vim
:Neotest run
```

You should see the test output in a floating window or the Neotest summary panel.

## Basic Usage

Once installed, you can use Neotest commands:

| Command | Description |
|---------|-------------|
| `:Neotest run` | Run the nearest test to the cursor |
| `:Neotest run file` | Run all tests in the current file |
| `:Neotest run directory` | Run all tests in a directory |
| `:Neotest stop` | Stop running tests |
| `:Neotest summary` | Toggle the test summary panel |
| `:Neotest output` | Show output for a test |
| `:Neotest output-panel` | Toggle the output panel |

### Keymaps Example

```lua
vim.keymap.set('n', '<leader>tt', function() require('neotest').run.run() end)
vim.keymap.set('n', '<leader>tf', function() require('neotest').run.run(vim.fn.expand('%')) end)
vim.keymap.set('n', '<leader>ts', function() require('neotest').summary.toggle() end)
vim.keymap.set('n', '<leader>to', function() require('neotest').output.open({ enter = true }) end)
vim.keymap.set('n', '<leader>td', function() require('neotest').run.run({ strategy = 'dap' }) end)
```

## Next Steps

- [[Configuration|2.-Configuration]] — Customize args and options
- [[Supported Test Libraries|3.-Supported-Test-Libraries]] — Learn about supported test libraries
- [[Debugging]] — Set up test debugging with nvim-dap
